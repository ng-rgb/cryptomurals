<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRYPTOMURALS</title>
    <link rel="icon" href="./resources/favicon.ico" />
    <link rel="stylesheet" href="./navBar.css">
    <link rel="stylesheet" href="./main.css">
    <link rel="stylesheet" href="./hamburger.css">
    <link rel="stylesheet" href="./gallery.css">
    
    <style>
        /* fixes */
        /* .mcontent.isOpen  */
        /* #navContainer, #main{ */
        #logo, #logbtutton, #main{
            transition: transform 0.3s;
        }

        #navContainer{
            display: grid;
            grid-template-columns: 1fr repeat(3, auto) 1fr;
            grid-template-columns: 1fr 2fr 1fr;
            grid-column-gap: 5px;
            justify-items: center;
            grid-template-areas: "city logo logbutton";
        }
    
        #city{
          grid-area: city;
        }
        #logo{
          grid-area: logo;
        }
        #logbutton{
          grid-area: logbutton;
        }
    
       .navIsOpen{
            transform: scale(0.8);
            opacity: 0.6;
            transition: transform 0.3s;
        }
        #main-navbar{
          width: 100vw!important;
          overflow:hidden;       
        }
        
        #addr{
            font-size: 0.81em;
            margin-left: 30px;
            margin-right: 30px;
            line-height: 80px;
        }
        #addrCont{
          width:100%
        }

        @media (max-width: 768px){
            #navContainer{
                flex-direction:column!important;
            }

            .hamburguer-menu-container{
                position: absolute;
                top: 40px;
            }
            
            #addr{
                    line-height: 42px;
            }
        }
      </style>
</head>
<body>
  <main>
    <!-- MENU -->
    <div style="display: inline-flex;flex: 1" class="menu">
      
          <!-- 1 icono y city -->
          <!-- <div style="display: flex" class='hamburguer-menu-container'>
            <div style="align-self: center; width: 100px;" class='hamburger hamburger--vortex-r hamburguer-menu'>
              <div class='hamburger-box'>
                <div class='hamburger-inner'></div>
              </div>
            </div>
            <div style=" margin: auto; color: white; text-decoration: underline; font-family: Monoton; " class='mn city-layout'> CITY </div>
          </div> -->
    
        <!-- 2 menu contents -->
          <div style=" position: fixed; top: 90px; left: 0px; width: 600px; z-index: 999" class="menu-main hidden">
            <div class='options-menu'>Home</div>
            <div class='options-menu'><a href="https://gardens.1hive.org/#/matic/garden/0x963d4a1cd9fb345a624e46c9470df572f0b35a72" target="_blank">Join the DAO</a></div>
            <div class='options-menu'><a href="Whitepaper_CRYPTOMURALS_v1_2022.pdf" target="_blank">WHITE PAPER</a></div>
          </div>
    
    </div>
    
    
    <!-- HEAD -->
      <!-- <div id="main-navbar"> -->
       
      <div  id='navContainer'  class=''>
    
        <div id="city" style="display: flex" class='hamburguer-menu-container'>
          <div style="align-self: center; width: 100px;" class='hamburger hamburger--vortex-r hamburguer-menu'>
            <div class='hamburger-box'>
              <div class='hamburger-inner'></div>
            </div>
          </div>
          <div style=" margin: auto; color: white; text-decoration: underline; font-family: Monoton; " class='mn city-layout'> CITY </div>
        </div>
        
            <!-- 1 LOGO -->
              <div id="logo" class='' >
                <div style="justify-content: center">
                  <img class='logo-cryptomurals' width='100%' height='100px' src="./resources/logo_cryptomurals.svg"
                    alt="logo cryptomurals" />
                </div>
              </div>
    
              <!-- 2 LOGIN/OUT -->
                <div id='logbutton' style=" display: flex; flex-direction: row; margin: 0 auto; justify-content: flex-end; text-align: center;">
                  <div id="logg" style="align-self: center; width: auto" class='btn-connect-container'>
                    <button style=" border-radius: 25px; border: none; font-family: Monda; background-Image: linear-gradient(90deg, rgba(46,167,227, 1) 0%, rgba(46, 167,227,1) 10%, rgba(250,4,254,1) 90%); color: white; word-spacing: 5px;" class='btn-connect-wallet' 
                    onclick="login()"> Connect Wallet </button>
                  </div>
              </div>
    
    
        </div>
            <div
                style="display: flex;flex: 1;width: 100%"
                class="main-container"
            >
              <div
                style="
                  position: absolute;
                  z-index: 1;
                  width: 100%;
                  height: 100%;
                "
                class="contain-svg-lines"
              >
              </div>
              <div class="grid-balloons">
              </div> 
            </div>
        </main>
        <script type="module" src="./js/CustomViewer.js"></script>
        <script type="module" src="./js/LinesSVG.js"></script>
        <script type="module" src="./js/LinesMobileSVG.js"></script>
        <script>
             
             let _mainContainer = document.querySelector("main");

             var listArtistMurals = [
               { 
                muralName: 'OBEY GIANT',
                artist: 'Cristian Ospina', 
                url: '/mural.html?mural=1',
                urlImg: "https://www.verticalpop.com/wp-content/uploads/2017/01/wall-mural-1559508_1920-1080x675.jpg",
                screenSM: {
                  marginTop: 420,
                  top: -80,
                  left: 100,
                  zone: "zone1",
                  zIndex: 2, 
                },
                screenXL: {
                  marginTop: 300,
                  top: -80,
                  left: 160,
                  zone: "zone1",
                  zIndex: 2, 
                }
              },
              {
                muralName: 'INTI' ,
                artist: 'Cristian Ospina', 
                url: '/mural.html?mural=2',
                urlImg: "",
                screenSM: {
                  marginTop: 195,
                  top: 45,
                  left: 10,
                  zone: "zone2",
                  zIndex: 1
                },
                screenXL: {
                  marginTop: 175,
                  top: 0,
                  left: 80,
                  zone: "zone2",
                  zIndex: 1
                }
              },
              {
                muralName: 'SETH' ,
                artist: 'Cristian Ospina', 
                url: '/mural.html?mural=3',
                urlImg: "",
                screenSM: {
                  marginTop: 20,
                  top: 50,
                  left: -80,
                  zone: "zone3", 
                },
                screenXL: {
                  marginTop: 20,
                  top: 45,
                  left: 80,
                  zone: "zone3", 
                }
              },
              {
                muralName: 'ADD FUEL' ,
                artist: 'Cristian Ospina', 
                url: '/mural.html?mural=4',
                urlImg: "",
                screenSM: {
                  marginTop: 120,
                  top: 95,
                  left:-160,
                  zone: "zone4",
                },
                screenXL: {
                  marginTop: 70,
                  top: 0,
                  left: 160,
                  zone: "zone4",
                }
              },
              {
                muralName: 'D*FACE',
                artist: 'Cristian Ospina', 
                url: '/mural.html?mural=5',
                urlImg: "",
                screenSM: {
                  marginTop: 240,
                  top: 60,
                  left: -160,
                  zone: "zone5"
                },
                screenXL: {
                  marginTop: 0,
                  top: 0,
                  left: 160,
                  zone: "zone5"
                }
              }
             ];

             var arrayIndexes = Array(listArtistMurals.length).fill(false);

             let height =  window.innerWidth;
             let width = window.innerHeight;

            function updateArrayIndexes(prevArrayIndexes, newArrayIndexes){
              prevArrayIndexes = newArrayIndexes;
            }

            function unselect(arrayIndexes){
                return arrayIndexes.map(() => false);
            }

             _mainContainer.addEventListener("click", (e) => {
                newArrayIndexes = unselect(arrayIndexes);
                arrayIndexes = newArrayIndexes;
                render();
             });

             function handlerClick(e, index, value){
                    e.stopPropagation();
                    let newArrayIndexes = arrayIndexes.map((el, i) => (i == index ? value : false));
                    arrayIndexes = newArrayIndexes
                    render();
            };

            window.addEventListener("DOMContentLoaded", () => {
              render();
              renderSVG();
            })

            function renderSVG(){
              const _containerSVG = document.querySelector(".contain-svg-lines");
              if(window.innerWidth < 768){
                _containerSVG.innerHTML = `<lines-mobile-svg></lines-mobile-svg>`
              } else {
                _containerSVG.innerHTML = `<lines-svg></lines-svg>`
              }
            }

            function render(){
                const _containerBallons = document.querySelector(".grid-balloons");
                if(window.innerWidth < 768){
                    _containerBallons.innerHTML = `
                                <div
                                    style="
                                    display: grid;
                                    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
                                    grid-template-rows: 1fr;
                                    grid-template-areas: 'zone1 zone2 zone3 zone4 zone5';
                                    width: 100vw;
                                    position: relative;
                                    z-index: 1;
                                    "
                                >
                                ${listArtistMurals.map((dataMural, index)=>{
                                  var component = !arrayIndexes[index]? (`
                                                        <div
                                                            style="
                                                            margin: 0 auto;
                                                            margin-top: ${dataMural.screenSM.marginTop}px;
                                                            background: radial-gradient(circle, rgba(109, 220, 155, 0.8) 30%, rgba(11, 185, 225, 0.8) 80%, rgba(9, 204, 249, 0.8) 100%);
                                                            height: auto;
                                                            width: ${window.innerWidth < 768 ? "80px" : "100px"};
                                                            height: ${window.innerWidth < 768 ? "80px" : "100px"};
                                                            border-radius: 50%;
                                                            position: ${arrayIndexes[index] ? 'relative' : 'initial'};
                                                            display: flex;
                                                            "
                                                            class="balloon"
                                                            onclick="handlerClick(event,${index}, true)"
                                                        >
                                                            <div
                                                            style="
                                                                font-family: Monda;
                                                                font-size: 18px;
                                                                color: white;
                                                                text-align: center;
                                                                margin: auto;
                                                            ">
                                                            ${dataMural.muralName}
                                                            </div>
                                                        </div>`):(`
                                                        <div style={{ display: 'flex', flexDirection: 'row' }}>
                                                        <div
                                                            style="
                                                            color: white;
                                                            font-family: Monda;
                                                            display: flex;
                                                            margin: 0 auto;
                                                            margin-top: ${dataMural.screenSM.marginTop}px;
                                                            position: relative;
                                                            "
                                                            onclick="handlerClick(event,${index}, false)"
                                                        >
                                                            <div
                                                            style="
                                                                margin: auto;
                                                                font-size: 23px;
                                                                text-align: center"
                                                            >
                                                                ${dataMural.muralName}
                                                            </div>
                                                            <custom-viewer 
                                                              url="${dataMural.url}"
                                                              urlimg="${dataMural.urlImg}"
                                                              top="${dataMural.screenSM.top}"
                                                              left="${dataMural.screenSM.left}"
                                                            >
                                                            </custom-viewer>
                                                        </div>
                                                        </div>`);

                                  return `<div style="grid-area: ${dataMural.screenSM.zone}; color: white; z-index: ${dataMural.screenSM.zIndex}">
                                            ${component}
                                         </div>`
                                }).join("")}
                                <slot></slot>
                                </div>`
                } else {
                    _containerBallons.innerHTML = `
                          <div
                            style="
                              display: grid;
                              grid-template-columns: 1fr 1fr 1fr minmax(150px, 400px) 200px minmax(150px, 400px);
                              grid-template-rows: 1fr;
                              grid-template-areas: 'zone1 zone2 zone3 zone4 zone5';
                              width: 100vw;
                              position: relative;
                              z-Index: 1;
                            "
                          >
                          ${listArtistMurals.map((dataMural, index) => {
                                  var component = !arrayIndexes[index]? (`
                                                    <div
                                                      style="
                                                            margin: 0 auto;
                                                            margin-top: ${dataMural.screenXL.marginTop}px;
                                                            background: radial-gradient(circle, rgba(109, 220, 155, 0.8) 30%, rgba(11, 185, 225, 0.8) 80%, rgba(9, 204, 249, 0.8) 100%);
                                                            height: auto;
                                                            width: ${window.innerWidth < 768 ? "50px" : "100px"};
                                                            height: ${window.innerWidth < 768 ? "50px" : "100px"};
                                                            border-radius: 50%;
                                                            position: ${arrayIndexes[index] ? 'relative' : 'initial'};
                                                      "
                                                      class='balloon'
                                                      onclick="handlerClick(event,${index}, true)"
                                                    ></div>
                                                    <div
                                                      style="
                                                            font-family: Monda;
                                                            font-size: 25px;
                                                            color: white;
                                                            text-align: center;
                                                          "
                                                    >
                                                    ${dataMural.muralName}
                                                    </div>`): (`
                                                    <div style="display: flex; flex-direction: row">
                                                        <div
                                                          style="
                                                            color: white;
                                                            font-family: Monda;
                                                            display: flex;
                                                            margin: 0px auto;
                                                            margin-top: ${dataMural.screenXL.marginTop + (window.innerWidth < 768 ? 50 : 100)}px; 
                                                            position: relative;
                                                          "
                                                          onclick="handlerClick(event,${index}, false)"
                                                        >
                                                          <div
                                                            style="
                                                                margin: auto;
                                                                font-size: 24px;
                                                                text-align: center"
                                                          >
                                                            ${dataMural.muralName}
                                                          </div>
                                                          <custom-viewer 
                                                              url=${dataMural.url} 
                                                              urlimg=${dataMural.urlImg}
                                                              top=${dataMural.screenXL.top}
                                                              left=${dataMural.screenXL.left}
                                                            >
                                                          </custom-viewer>
                                                        </div>
                                                      </div>`);
                                  
                                  return `<div style="grid-area: ${dataMural.screenXL.zone}; color: white; z-index: ${dataMural.screenXL.zIndex}">
                                            ${component}
                                          </div>`
                                }).join("")                             
                          }
                          </div>`;
                } 

            }

             window.addEventListener('resize', () => {
                console.log('resized to: ', window.innerWidth, ', x: ', window.innerHeight);
                render();
                renderSVG();
            });

            

            

            /*********************************************************************************************
            .) LOGG stuff
            **********************************************************************************************/


            // 0. Check moralis
            const serverUrl = "https://hyorvrgxcdmm.usemoralis.com:2053/server";
            const appId = "Lx28OvD1jYsfl8Q52brKgUbJ1yGP9kWgffDg2hrU";
            // Moralis.start({ serverUrl, appId });
            // const CHAIN = "mumbai";
            // const TOKEN_CONTRACT_ADDRESS = "0x41854405916B936Eb079F9F83d8077d67b72bCC9";



            const init = async () => {
            await Moralis.start({
            appId : appId,
            serverUrl: serverUrl
            });
            Moralis.initPlugins();
            };

            init();

            //  LOGIN
            async function login() {
            console.log('login tryied');
            let user = Moralis.User.current();
            if (!user) {
                try {
                let user = await Moralis.authenticate({
                    signingMessage: "Hello from cryoptomurals!"
                })
                let userAddress = user.get('ethAddress');

                var x = userAddress;
                // var shortAddr = x.substring(0, 8) + "...";
                var shortAddr = x.substring(0, 6) + "..."+x.substring(38, 42);

                // document.getElementById("logg").innerHTML = "<p class='loged btn-grad-inv'>" + shortAddr + " <i class='logout fa fa-sign-out' aria-hidden='true' onclick='event.stopPropagation();logOut()'></i> </p> <p style='display:none' class='responsiveloged btn-grad-inv'> <i class='logout fa fa-sign-out' aria-hidden='true' onclick='event.stopPropagation();logOut()'></i> </p>";

                // document.getElementById("logg").innerHTML=`  <div style="width:auto;height: 50px" class="" onclick="logOut()">
                //       <div style="border-radius: 50%; background-image: linear-gradient(90deg, rgba(46,167,227, 1) 0%, rgba(46, 167,227,1) 10%, rgba(250,4,254,1) 90%); color: white;" class='btn-connected'></div>
                //       <div style="font-family:Monda; color: white"> ${shortAddr}</div>
                //     </div>`
                    document.getElementById("logg").innerHTML=`  <div style="width:auto;height: 50px" class="" onclick="logOut()">
                        <div id='addrCont' style="border-radius: 50%; background-image: linear-gradient(90deg, rgba(46,167,227, 1) 0%, rgba(46, 167,227,1) 10%, rgba(250,4,254,1) 90%); color: white;" class='btn-connected'>
                        <div id='addr' style="font-family:Monda; color: white"> ${shortAddr}</div>
                        </div>
                    </div>`

                console.log('User address: ', userAddress);

                } catch (error) {
                console.log(error)
                }
            } else {
                console.log('user is already here...');
                Moralis.enableWeb3(); //if user has a sesion authenticate is not called so metamaks is not initiated, here we fix this
                let userAddress = user.get('ethAddress');
                var x = userAddress;
                // var shortAddr = x.substring(0, 8) + "...";
                var shortAddr = x.substring(0, 6) + "..."+x.substring(38, 42);
                document.getElementById("logg").innerHTML=`<div style="width:auto;height: 50px" class="" onclick="logOut()">
                        <div id='addrCont' style="border-radius: 50%; background-image: linear-gradient(90deg, rgba(46,167,227, 1) 0%, rgba(46, 167,227,1) 10%, rgba(250,4,254,1) 90%); color: white;" class='btn-connected'>
                        <div id='addr' style="font-family:Monda; color: white"> ${shortAddr}</div>
                        </div>
                    </div>`
                }
            }



        </script>
    </div>
</body>